<script type="text/javascript">
	RED.nodes.registerType('wio-sensor', {
		paletteLabel: 'sensor',
		category: 'wio',
		color: '#C0EDC0',
		defaults: {
			name: { value: '' },
			connection: { value: '', type: 'wio-config' },
			node: { value: '' },
			port: { value: '' },
			method: { value: '' },
			output: { value: 'value' }
		},
		inputs: 1,
		outputs: 1,
		icon: 'file.png',
		label: function () {
			return this.name || 'sensor';
		},
		oneditprepare: function () {
			var config = this;
			var skus = {
				'101020015': { module: 'GroveTemp', name: 'Grove Temperature' },
				'101020019-ffff': { module: 'GroveTempHum', name: 'Grove Temperature & Humidity' },
				'101020010': { module: 'GroveUltraRanger', name: 'Grove Ultrasonic Ranger' },
				'101020020': { module: 'GrovePIRMotion', name: 'Grove PIR Motion' },
				'101020078': { module: 'GroveAirquality', name: 'Grove Air Quality' },
				'101020192': { module: 'GroveBaroBMP280', name: 'Grove Barometer BMP280' },
				'101020030': { module: 'GroveDigitalLight', name: 'Grove Digital Light' },
				'101020008': { module: 'GroveMoisture', name: 'Grove Moisture' },
				'101020083': { module: 'GroveGesture', name: 'Grove Gesture' },
				'101020016': { module: 'GroveIRRecv', name: 'Grove Infrared Receiver' },
				'101020038': { module: 'GroveMagneticSwitch', name: 'Grove Magnetic Switch' }
			}
			$.getScript('wio-common').done(function (res) {
				WioCommon(config, skus);

				var ports = $('#node-input-port');
				var modules = $('#node-input-module');
				var methods = $('#node-input-method');

				showModuleMethods();

				ports.on('change', function () {
					showModuleMethods(ports.find('option:selected').attr('data-wio-module'));
				});

				function showModuleMethods(module) {
					methods.val('').find('option').hide();
					if (module) {
						methods.val(methods.find('option[data-option-for="' + module + '"]').show().first().attr('value'));
					}
				}
			});
		}
	});
</script>

<script type="text/x-red" data-template-name="wio-sensor">
	<div class="form-row">
		<label for="node-input-name"><i class="icon-tag"></i> Name</label>
		<input type="text" id="node-input-name" placeholder="Name">
	</div>
	<div class="form-row">
		<label for="node-input-connection"><i class="icon-tag"></i> Connection</label>
		<select type="text" id="node-input-connection"></select>
	</div>
	<div class="form-row">
		<label for="node-input-node"><i class="icon-tag"></i> Node</label>
		<select type="text" id="node-input-node"></select>
	</div>
	<div class="form-row">
		<label for="node-input-port"><i class="icon-tag"></i> Port</label>
		<select type="text" id="node-input-port"></select>
	</div>
	<div class="form-row">
		<label for="node-input-method"><i class="icon-tag"></i> Method</label>
		<select type="text" id="node-input-method">
			<option data-option-for="GroveTemp" value="temp">Celsius Temperature</option>
			<option data-option-for="GroveTempHum" value="temperature">Celsius Temperature</option>
			<option data-option-for="GroveTempHum" value="temperature_f">Fahrenheit Temperature</option>
			<option data-option-for="GroveTempHum" value="humidity">Humidity</option>
			<option data-option-for="GroveUltraRanger" value="range_in_inch">Inches Range</option>
			<option data-option-for="GroveUltraRanger" value="range_in_cm">Centimeters Range</option>
			<option data-option-for="GrovePIRMotion" value="approach">Approach</option>
			<option data-option-for="GroveAirquality" value="quality">Quality</option>
			<option data-option-for="GroveBaroBMP280" value="temperature">Celsius Temperature</option>
			<option data-option-for="GroveBaroBMP280" value="altitude">Altitude</option>
			<option data-option-for="GroveBaroBMP280" value="pressure">Pressure</option>
			<option data-option-for="GroveDigitalLight" value="lux">Lux</option>
			<option data-option-for="GroveMoisture" value="moisture">Moisture</option>
			<option data-option-for="GroveGesture" value="motion">Motion</option>
			<option data-option-for="GroveIRRecv" value="protocol_parameters">Protocol Parameters</option>
			<option data-option-for="GroveIRRecv" value="last_data_recved">Received Data</option>
			<option data-option-for="GroveMagneticSwitch" value="approach">Approach</option>
		</select>
	</div>
	<div class="form-row">
		<label for="node-input-output"><i class="icon-tag"></i> Output</label>
		<select type="text" id="node-input-output">
			<option value="value">Parsed Value</option>
			<option value="object">Raw Object</option>
		</select>
	</div>
</script>

<script type="text/x-red" data-help-name="wio-sensor">
	<p>Wio Sensor</p>
</script>